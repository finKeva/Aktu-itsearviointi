<!DOCTYPE html>
<html lang="fi">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>-->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <title>Aktiivisen tuen toimintatavan itseariointi</title>
    <!--<style>
      div.fader {
        opacity:    0.5; 
        background: #000; 
        width:      100%;
        height:     100%; 
        z-index:    10;
        top:        0; 
        left:       0; 
        position:   fixed; 
      }
    </style>-->
</head>

<body>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!--<div id="fader"></div>-->
<div class="container theme-showcase" role="main">

  <div class="page-header">
   <h1>Aktiivisen tuen toimintatavan itsearviointi</h1>
  </div>
  
  <div id="page-info">
    <p>Kullakin organisaatiolla on oma toimintatapansa johtaa työhyvinvointia ja työkykyä. Organisaatiot kutsuvat omia toimintatapojaan tai mallejaan eri nimillä. Keva käyttää nimitystä Aktiivisen tuen toimintatapa. Siihen sisältyy varhainen tuki, tehostettu tuki ja paluun tuki sekä työterveysyhteistyö.</p>
    <!--<p>
      Arviointi annetaan pisteyttämällä väittämät seuraavasti: 
      <ul>
        <li>asia on huomioitu kattavasti 	2 pistettä</li>
        <li>asia on huomioitu osittain 	1 pistettä</li>
        <li>asiaa ei ole huomioitu 	0 pistettä</li>
      </ul>
    </p>-->
    <p>
      Arvioi seuraavia väittämiä. Vastausvaihtoehdot ovat:  
      <ul>
        <li>0 = asia ei toteudu</li>
        <li>1 = asia toteutuu osittain</li>
        <li>2 = asia toteutuu kattavasti</li>
      </ul>
    </p>
  </div>

  <div id="questionnaire">Ladataan...</div>

  <button type="button" class="btn btn-success" id="katso-tuloksia">
    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Katso tuloksia
  </button>

  <div class="btn-toolbar" role="toolbar" id="tulokset-button-toolbar">
    <button type="button" class="btn btn-info" id="muokkaa-vastauksia">
      <span class="glyphicon glyphicon-random" aria-hidden="true"></span> Muokkaa vastauksia
    </button>
    <button type="button" class="btn btn-default" id="tulostaa-tulokset">
      <span class="glyphicon glyphicon-print" aria-hidden="true"></span> Tulosta / Tallenna pdf:ksi
    </button>
    <button type="button" class="btn btn-default" id="laheta-asiantuntijalle">
      <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span> Lähetä asiantuntijalle
    </button>
    <button type="button" class="btn btn-default" id="tallenna-tulokset-palvelimelle">
      <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span> Tallenna Kevan palvelimelle
    </button>
  </div>
  <div id="results">Ladataan...</div>

  <p> </p>
      
  <!-- ####################### #################### ###################### --
  <div id="tulokset" style="display:none;">
    <div class="page-header">
     <h2>Tulokset</h2>
    </div>
    <p id="vastausmaara-perus"></p>
    <div class="progress" id="progress-perus">
      <div class="progress-bar progress-bar-success" style="width: 0%">
        <span class="sr-only"></span>
      </div>
      <div class="progress-bar progress-bar-warning" style="width: 0%">
        <span class="sr-only"></span>
      </div>
      <div class="progress-bar progress-bar-danger" style="width: 0%">
        <span class="sr-only"></span>
      </div>
    </div>
    <p>Sanallinen palaute Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer auctor dui neque, non vehicula mauris pellentesque ut. Mauris quis elit vulputate, tincidunt ex ut, dignissim nisl. Fusce condimentum, quam et pulvinar interdum, diam urna tincidunt elit, eget vulputate nunc lectus vitae dui. Nulla vel convallis orci. Proin ac aliquam quam, in pulvinar neque. Phasellus rhoncus sed turpis quis varius. Integer eu nisi sed nisl lobortis blandit quis a nisl. Donec facilisis augue erat, sed ullamcorper metus consequat at. Cras pellentesque dui velit, nec vestibulum sem tempor ac. Donec porttitor commodo nisl, eu feugiat massa ornare nec. Aliquam erat volutpat. Vestibulum fermentum, velit id consequat sollicitudin, dui mi condimentum nulla, sit amet dictum mi velit in est. Integer scelerisque gravida ipsum, nec pulvinar erat. Fusce id ex ac nunc rhoncus condimentum quis ac risus. Ut vel risus molestie nisl sollicitudin fringilla.</p>  
    <p>Mahdollinen vertailu muihin organisaatioihin</p>  
  </div>
</div> -->
<p> </p>


<script type="text/javascript" charset="UTF-8">

var kysely =
[
  {
    "sectionHeader": "Perusrakenne",
    "sectionId": "perus",
    "sectionResponceScale": [0,1,2],
    "sectionResponceInfo": "0 ei toteudu, 1 toteutuu osittain, 2 toteutuu kattavasti",
    "sectionResponceScaleInfo": "Arvio (0-2)",
    "parts": [
      {
        "partDefinition": "<strong>Varhaisella tuella tarkoitetaan</strong> esimiehen ja työyksikön omia toimia työkykyongelmien ja työyhteisöongelmien ehkäisemiseksi.",
        "partHeader": "varhainen tuki",
        "partId": "vatu",
        "questions": [
          {
            "questionId" : 1,
            "questionText" : "Varhainen tuki on käytössä",
            "questionResponce" : ""
          }, {
            "questionId" : 2,
            "questionText" : "Toimijoiden roolit ja vastuut on kuvattu varhaisen tuen vaiheessa"
          }, {
            "questionId" : 3,
            "questionText" : "Varhaisen tuen vaiheesta on tehty prosessikuvaus"
          }, {
            "questionId" : 4,
            "questionText" : "Esimiehet tunnistavat varhaisen tuen tarpeita jo ennen poissaolohälytyksiä (kun huoli herää)"
          } ]
      },{
        "partDefinition": "<strong>Tehostetulla tuella tarkoitetaan</strong> toimia, joilla työssä jatkamista tuetaan, kun työntekijän työkyky on jo heikentynyt tai kun työyhteisössä on jo ongelmia. Tehostettuun tukeen siirrytään kun esimiehen omat toimet eivät enää riitä, vaan hän tarvitsee yhteistyökumppaneita.",
        "partHeader": "tehostettu tuki",
        "partId": "tetu",
        "questions": [
          {
            "questionId" : 1,
            "questionText" : "Tehostettu tuki on käytössä"
          }, {
            "questionId" : 2,
            "questionText" : "Toimijoiden roolit ja vastuut on kuvattu tehostetun tuen vaiheessa"
          }, {
            "questionId" : 3,
            "questionText" : "Tehostetun tuen vaiheesta on tehty prosessikuvaus"
          }, {
            "questionId" : 4,
            "questionText" : "Esimiehet tunnistavat tehostetun tuen vaiheen vaihtoehtoja (esim. ammatillinen kuntoutus, osasairauspäiväraha, osatyökyvyttömyyseläke, työyhteisösovittelu)"
          } ]
      },{
        "partDefinition": "<strong>Paluun tuella tarkoitetaan</strong> toimia, joilla tuetaan työntekijän palaamista työhön esimerkiksi pitkän sairauspoissaolon jälkeen.",
        "partHeader": "paluun tuki",
        "partId": "petu",
        "questions": [
          {
            "questionId" : 1,
            "questionText" : "Paluun tuki on käytössä"
          }, {
            "questionId" : 2,
            "questionText" : "Toimijoiden roolit ja vastuut on kuvattu paluun tuen vaiheessa"
          }, {
            "questionId" : 3,
            "questionText" : "Paluun tuen vaiheesta on tehty prosessikuvaus"
          }, {
            "questionId" : 4,
            "questionText" : "Esimiehet sopivat yhteydenpidosta jo työntekijän sairauspoissaolon alkaessa"
          } ]
      } ]
  }, {
    "sectionHeader": "Toimintatavan selkeys",
    "sectionId": "toimintaselkeys",
    "sectionResponceScale": [0,1,2],
    "sectionResponceInfo": "0 ei toteudu, 1 toteutuu osittain, 2 toteutuu kattavasti",
    "sectionResponceScaleInfo": "Arvio (0-2)",
    "parts": [
      {
        "partDefinition": "",
        "partHeader": "",
        "partId": "ts",
        "questions": [
          {
            "questionId" : 1,
            "questionText" : "Toimintatapa on esimiesnäkökulmasta selkeä ja ymmärrettävä"
          }, {
            "questionId" : 2,
            "questionText" : "Esimies tietää, keneen on yhteydessä eri tilanteissa"
          }, {
            "questionId" : 3,
            "questionText" : "Toimintatavassa on kuvattu prosessin kulku erilaisissa työkykyä heikentävissä tilanteissa"
          }, {
            "questionId" : 4,
            "questionText" : "Toimintatapa on helposti löydettävissä esim. intrasta"
          } ]
      } ]
  }, {
    "sectionHeader": "Toimintatavan juurruttaminen",
    "sectionId": "toimintajuurrutus",
    "sectionResponceScale": [0,1,2],
    "sectionResponceInfo": "0 ei toteudu, 1 toteutuu osittain, 2 toteutuu kattavasti",
    "sectionResponceScaleInfo": "Arvio (0-2)",
    "parts": [
      {
        "partDefinition": "",
        "partHeader": "",
        "partId": "tj",
        "questions": [
          {
            "questionId" : 1,
            "questionText" : "Esimiehet käyttävät toimintatapaa aktiivisesti ja oikea-aikaisesti"
          }, {
            "questionId" : 2,
            "questionText" : "Henkilöstö ymmärtää toimintatavan merkityksen"
          }, {
            "questionId" : 3,
            "questionText" : "Henkilöstö käyttää toimintatapaa aktiivisesti"
          }, {
            "questionId" : 4,
            "questionText" : "Toimintatapa on osa uuden työntekijän ja esimiehen perehdytysohjelmaa"
          }, {
            "questionId" : 5,
            "questionText" : "Toimintatapaa päivitetään aina tarvittaessa"
          }, {
            "questionId" : 6,
            "questionText" : "Toimintatapaa päivitetään laaja-alaisessa yhteistyössä keskeisten toimijoiden kanssa"
          }, {
            "questionId" : 7,
            "questionText" : "Työterveyshuolto toimii aktiivisesti toimintatavan juurruttamisessa"
          } ]
      } ]
  }, {
    "sectionHeader": "Aktiivisen tuen toimintatavan johtaminen",
    "sectionId": "aktujohto",
    "sectionResponceScale": [0,1,2],
    "sectionResponceInfo": "0 ei toteudu, 1 toteutuu osittain, 2 toteutuu kattavasti",
    "sectionResponceScaleInfo": "Arvio (0-2)",
    "parts": [
      {
        "partDefinition": "",
        "partHeader": "",
        "partId": "aj",
        "questions": [
          {
            "questionId" : 1,
            "questionText" : "Aktiivisen tuen toimivuudelle on asetettu selkeät muutostavoitteet (koskien esim. työilmapiirin parantamista, henkilöstön työhyvinvoinnin parantamista, sairauspoissaolojen vähentämistä, työkyvyttömyyseläkkeiden vähentämistä)"
          }, {
            "questionId" : 2,
            "questionText" : "Tavoitteiden toteutumista/ muutosta aikaisempaan tilanteeseen arvioidaan selkein mittarein"
          }, {
            "questionId" : 3,
            "questionText" : "Eri johtamisen tasoille on määritelty omat seurattavat mittarit (työyksikkötaso, toimialataso, organisaatiotaso)"
          }, {
            "questionId" : 4,
            "questionText" : "Seuranta- ja arviointivastuut on määritelty selkeästi (lähiesimiehet, toimialajohto)"
          }, {
            "questionId" : 5,
            "questionText" : "Henkilöstön tilaa ja henkilöstömuutoksia ennakoidaan säännöllisesti ja ryhdytään tarvittaviin toimenpiteisiin"
          }, {
            "questionId" : 6,
            "questionText" : "Aktiivien tuen toimintatavan kokonaisvastuu on määritetty jollekin taholle"
          }, {
            "questionId" : 7,
            "questionText" : "Työkyvyttömyyskustannusten seuranta on vastuutettu jollekin taholle ja tietoja analysoidaan säännöllisesti ja ryhdytään sovittuihin toimenpiteisiin"
          }, {
            "questionId" : 8,
            "questionText" : "Aktiivisen tuen seurantaan on sähköinen järjestelmä, joka edellyttää esimieheltä reagointia"
          }, {
            "questionId" : 9,
            "questionText" : "Osatyökykyisten sijoittuminen yli toimialarajojen on mahdollistettu"
          }, {
            "questionId" : 10,
            "questionText" : "Toimintatavassa on myös esitetty viimeisenä vaihtoehtona työsuhteen päättäminen, jos mitkään muut vaihtoehdot eivät tuo ratkaisua"
          }, {
            "questionId" : 11,
            "questionText" : "Organisaation taloudellisen ja toiminnallisten päätösten yhteydessä arvioidaan niiden henkilöstövaikutuksia"
          } ]
      } ]
  }, {
    "sectionHeader": "Työterveysyhteistyö aktiivisen tuen toimintatavassa",
    "sectionId": "tthcoop",
    "sectionResponceScale": [0,1,2],
    "sectionResponceInfo": "ei 0, osittain 1, huomioitu 2",
    "sectionResponceScaleInfo": "Arvio (0-2)",
    "parts": [
      {
        "partDefinition": "",
        "partHeader": "",
        "partId": "tj",
        "questions": [
          {
            "questionId" : 1,
            "questionText" : "Työterveyshuollon toimintasuunnitelman keskeiset tavoitteet ovat linjassa aktiivisen tuen toiminnalle asetettuihin tavoitteisiin"
          }, {
            "questionId" : 2,
            "questionText" : "Työterveyshuollon toiminnalle on asetettu selkeät mittarit"
          }, {
            "questionId" : 3,
            "questionText" : "Esimiehet osaavat käyttää työterveyshuollon palveluja aktiivisen tuen tilanteissa"
          }, {
            "questionId" : 4,
            "questionText" : "Työterveyshuolto osaa aktiivisesti tarjota Kevan ja Kelan tarjoamia tukimuotoja työkyvyn ollessa alentunut"
          }, {
            "questionId" : 5,
            "questionText" : "Työterveyshuolto tuntee Kevan tarjoamaa ammatillista kuntoutusta ja sen edellytyksiä"
          }, {
            "questionId" : 6,
            "questionText" : "Työterveyshuolto tunnistaa työkykyriskissä olevan työntekijän ja työyhteisön jossa on ongelmia ja ryhtyy aktiivisesti toimenpiteisiin"
          }, {
            "questionId" : 7,
            "questionText" : "30, 60, 90 – sääntö ja siihen liittyvät toimenpiteet toimivat sujuvasti"
          }, {
            "questionId" : 8,
            "questionText" : "Työterveyshuollon roolit ja vastuut aktiivisen tuen toimintatavassa on selkeästi määritelty"
          } ]
      } ]
  }
  ];

</script>

<script>
$pageInfoContainer = $("div#page-info");
$mainContainer = $("div#questionnaire");
$resultsContainer = $("div#results");
$resultsButton = $("button#katso-tuloksia");
$resultsToolbar = $("div#tulokset-button-toolbar");
$editButton = $("button#muokkaa-vastauksia");
$printButton = $("button#tulostaa-tulokset");
$saveResultsButton = $("button#tallenna-tulokset-palvelimelle");
$sendToExpert = $("button#laheta-asiantuntijalle");
//$fader = $("div#fader");

$printResults = function(){
  if($resultsContainer.css('display')=='block')
    window.print();
}

$sendEmail = function(){
  event.preventDefault();
  //alert("Got ya!");
  var email = 'satu.haapakoski@keva.fi';
  var subject = 'Tämä on järjestelmä testi';
  var emailBody = 'Kirjoita oma viestisi tämän viivan yläpuolelle\n-------------------------------------------------------------------------\n\n';
  
  $.each(kysely, function(i, section) {
    emailBody += section.sectionHeader+"\n\n";
    
    $.each(section.parts, function(j, part) {
      emailBody += part.partHeader+"\n";
      
      $.each(part.questions, function(k, question) {
        if(question.questionResponce == undefined)
          //emailBody += "-\t"+question.questionText.substr(0,30)+"...\n";
          false;
        else
          emailBody += question.questionResponce+"\t"+question.questionText.substr(0,25)+"...\n";

      });
      emailBody += "\n";
      
    });
    emailBody += "\n";
  });
  
  console.log(emailBody);
  console.log(emailBody.length);
  window.location = 'mailto:' + email + '?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(emailBody);
}

$sendResultsToServer = function(){
  //$fader.show();
  $activeResponces = $("div.btn-group.btn-group-xs .active");
  var resultsToSave = new Object;
  //console.log($activeResponces);
  $.each($activeResponces, function(i, button) {
    var par_ids = $(button).attr("id").split("-");
    //console.log(par_ids);
    resultsToSave[par_ids[0]+"-"+par_ids[1]+"-"+par_ids[2]] = par_ids[3].substr(1,2);
  });
  //console.log(resultsToSave);
    
  $.ajax({
    url: "http://url",
    type: 'POST',
    contentType:'application/json',
    data: JSON.stringify(resultsToSave),
    dataType:'json',
    success: function(data){
      //On ajax success do this
      window.resultsToSave = resultsToSave;
      console.log(JSON.stringify(resultsToSave));
      alert("Tiedot onnistuneesti tallennettu!");
      //$fader.hide();
    },
    error: function(xhr, ajaxOptions, thrownError) {
      //On error do this
      //$.mobile.loading('hide')
      console.log(xhr);
      console.log(ajaxOptions);
      console.log(thrownError);
      console.log(JSON.stringify(resultsToSave));
      alert("Tietojen lähetys epäonnistui!");
      //$fader.hide();
      /*if (xhr.status == 200) {
        
        alert(ajaxOptions);
      }
      else {
        alert(xhr.status);
        alert(thrownError);
      }*/
    }
  });
  
}

$activateResponce = function() {
  var id = $( this ).attr('id');
  var par_ids = id.split("-");
  //console.log(par_ids);
  
  $.each(kysely, function(i, section) {
    if(section.sectionId == par_ids[0]){
      $.each(section.parts, function(j, part) {
        if(part.partId == par_ids[1]){
          $.each(part.questions, function(k, question) {
            if(question.questionId == par_ids[2].substr(1,2)){
              question.questionResponce = parseInt(par_ids[3].substr(1,2));
              return false;
            }
          });
          return false;
        }
      });
      return false;
    }
  });
  
  var len = id.length;
  var id_group = id.substr(0,len-1); 
  for(var i=0; i<=2; i++)
    $("#".concat(id_group,i)).removeClass("active");
  $( this ).addClass("active");
};

$createQuestionnaire = function() {
  $.each(kysely, function(i, section) {
    $sectionContainer = $("<div>", {id:section.sectionId + "-container"});
    $sectionContainer.append(
          $("<div>", {class:"page-header"}).append(
              $("<h2>",{text: section.sectionHeader})));
    
    $.each(section.parts, function(j, part) {
      $sectionContainer.append($("<p>",{html: part.partDefinition}));
      $qTable = $("<table>", {id:section.sectionId+"-"+part.partId, class: "table table-striped table-hover"});
      $qTable.append(
        $("<thead>")
          .append(
            $("<tr>")
              .append($("<th>", {class:"text-right", text:section.sectionResponceInfo}))
              .append($("<th>", {class:"text-center", text:section.sectionResponceScaleInfo}))));
      $qTable.append($("<tbody>"));
      
      $.each(part.questions, function(k, question) {
        $qRow = $("<tr>").append($("<td>",{text:question.questionText}))
        $qRow.append($("<td>", {class:"col-md-2 text-center",}));
        
        $buttonContainer = $("<div>", {id: section.sectionId+"-"+part.partId+"-k"+question.questionId+"-buttoncontainer", class: "btn-group btn-group-xs", role: "group"});
        $.each(section.sectionResponceScale, function(l) {
          $qButton = $("<button>", {type:"button", class:"btn btn-default", id:section.sectionId+"-"+part.partId+"-k"+question.questionId+"-v"+l, text: " "+l+" "})
          if(question.questionResponce === l)
            $qButton.addClass("active");
          $qButton.click($activateResponce);
          $qButton.appendTo($buttonContainer);
        });
        
        $buttonContainer.appendTo($("td:last-child",$qRow));
        $qRow.appendTo($("tbody",$qTable));
      });
  
      $qTable.appendTo($sectionContainer);
    });
    
    $sectionContainer.appendTo($mainContainer);
  });

  $("div#questionnaire table tbody tr:last-child td").css("border-bottom", "1px solid #ddd");
}

$createResults = function() {
  $yhteenVetoContainer = $("<div>", {id:"results-yhteenveto-container"});
  $yhteenVetoContainer.appendTo($resultsContainer);
  $yhteenVetoContainer.append(
          $("<div>", {class:"page-header"}).append(
              $("<h2>",{text: "Yhteenveto"})));

  $resultsContainer.append(
          $("<div>", {class:"page-header"}).append(
              $("<h2>",{text: "Kiinnitä huomiota seuraaviin kohtiin"})));
  
  $.each(kysely, function(i, section) {
    $sectionContainer = $("<div>", {id:"results-"+section.sectionId + "-container"});
    $sectionContainer.append(
          $("<div>", {class:"page-header"}).append(
              $("<h3>",{text: section.sectionHeader})));
    
    $.each(section.parts, function(j, part) {
      //sectionResponceScale
      $sectionContainer.append($("<p>",{html: part.partHeader, class:"text-capitalize lead"}));
      $sectionContainer.append($("<div>",{id:"results-"+section.sectionId+"-"+part.partId+"-poimitutkysymykset", class:"col-md-offset-1"}));
      /*$sectionContainer.append($("<p>",{id:"results2-"+section.sectionId+"-"+part.partId+"-vastausmaarapisteet"}));
      $sectionContainer
        .append(
          $("<div>", {class:"progress", id:"progressbar2-"+section.sectionId+"-"+part.partId})
            .append(
              $("<div>",{id:"results2-"+section.sectionId+"-"+part.partId+"-pisteet", class:"progress-bar progress-bar-success"})
            )
        );*/
        
      $yhteenVetoContainer
        .append($("<div>", {class:"row"})
          .append($("<div>", {class:"col-md-4", html:section.sectionHeader+", "+part.partHeader})
            .append($("<br>"))
            .append($("<span>",{class:"small text-right",id:"results-"+section.sectionId+"-"+part.partId+"-vastausmaarapisteet"}).css("font-style","italic")))
          .append($("<div>", {class:"col-md-8"})
            .append($("<div>", {class:"progress", id:"progressbar-"+section.sectionId+"-"+part.partId})
              .append($("<div>",{id:"results-"+section.sectionId+"-"+part.partId+"-pisteet", class:"progress-bar progress-bar-success"}))))
        );


  
    });
    
    $sectionContainer.appendTo($resultsContainer);
  });

}

$updateResults = function() {
  $.each(kysely, function(i, section) {
    
    $.each(section.parts, function(j, part) {
      var pisteet = 0;
      var vastausmaara = 0;
      var max_pisteet = Math.max.apply(Math, section.sectionResponceScale);
      var min_pisteet = undefined;
      $poimitutkysymykset = $("#results-"+section.sectionId+"-"+part.partId+"-poimitutkysymykset");
      $poimitutkysymykset
        .contents()
        .remove();
      
      $.each(part.questions, function(k, question) {
        if($.inArray(question.questionResponce, section.sectionResponceScale ) != -1){
          pisteet += question.questionResponce;
          vastausmaara++;
          if(question.questionResponce<min_pisteet || min_pisteet==undefined) min_pisteet = question.questionResponce;
        }
      });
      
      if(min_pisteet != undefined && min_pisteet != max_pisteet) {
        $poimitutkysymykset.append($("<p>",{html:"Vastasit "+min_pisteet+" seuraaviin väittämiin: "}));
        $.each(part.questions, function(k, question) {
          if(question.questionResponce == min_pisteet){
            $poimitutkysymykset.append($("<p>",{html:question.questionText,class:"small"}));
          }
        });
        
      } else {
        if(min_pisteet == undefined)
          $poimitutkysymykset.append($("<p>",{text:"Vastasit 0 väittämään"}));
        if(min_pisteet == max_pisteet)
          $poimitutkysymykset.append($("<p>",{text:"Vastasit kaikkiin väittämiin "+max_pisteet+", eli asiaa toteutuu kattavasti."}));
      }
      
      var maxpisteet = (part.questions.length*Math.max.apply(Math, section.sectionResponceScale))
      var pisteprosentti = Math.round(10000*pisteet/maxpisteet)/100;

      //$("#results2-"+section.sectionId+"-"+part.partId+"-vastausmaarapisteet").html("Vastasit "+vastausmaara+"/"+part.questions.length+" kysymykseen. Sait "+pisteet+"/"+maxpisteet+" pistettä.");
      $("#results-"+section.sectionId+"-"+part.partId+"-vastausmaarapisteet").html("vastaukset "+vastausmaara+"/"+part.questions.length);
      
      /*$("#results2-"+section.sectionId+"-"+part.partId+"-pisteet")
        .css("width", pisteprosentti+"%")
        .text("pisteesi");*/
      $("#results-"+section.sectionId+"-"+part.partId+"-pisteet")
        .css("width", pisteprosentti+"%")
        .text("pisteet "+pisteet+"/"+maxpisteet);
    });

  });

}


$switchQandR = function() {
  $updateResults();
  
  var timing = 700;
  $mainContainer.slideToggle(timing)
  $pageInfoContainer.slideToggle(timing);
  $resultsContainer.slideToggle(timing);
  $resultsButton.slideToggle(timing);
  $resultsToolbar.slideToggle(timing);
  $("html, body").animate({ scrollTop: 0 }, "slow");
}


</script>

<script>
$( document ).ready(function() {
  $mainContainer
      .contents()
      .remove();
  $createQuestionnaire();
  
  
  $mainContainer.show();
  $pageInfoContainer.show();
  $resultsContainer.hide();
  
  
  $resultsButton.click($switchQandR);
  $resultsButton.show();
  
  $editButton.click($switchQandR);
  $printButton.click($printResults);
  $saveResultsButton.click($sendResultsToServer);
  $sendToExpert.click($sendEmail);
  $resultsToolbar.hide();
  
  $resultsContainer
      .contents()
      .remove();
  $createResults();

});
</script>

</body>
</html>

